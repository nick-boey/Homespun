@page "/projects/create"
@using Homespun.Features.Projects
@inject ProjectService ProjectService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>New Project</PageTitle>

<h1>New Project</h1>

<form @onsubmit="HandleSubmit">
    <div class="mb-3">
        <label for="ownerRepo" class="form-label">GitHub Repository</label>
        <input type="text" class="form-control" id="ownerRepo" @bind="_ownerRepo" required
               placeholder="owner/repository" />
        <div class="form-text">
            Enter the GitHub repository in owner/repository format (e.g., microsoft/vscode).
            The repository will be cloned to ~/.homespun/src/&lt;repository&gt;/&lt;default-branch&gt;.
        </div>
    </div>

    @if (!string.IsNullOrEmpty(_errorMessage))
    {
        <div class="alert alert-danger" role="alert">
            @_errorMessage
        </div>
    }

    <button type="submit" class="btn btn-primary" disabled="@_isSubmitting">
        @if (_isSubmitting)
        {
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            <span>Creating...</span>
        }
        else
        {
            <span>Create</span>
        }
    </button>
    <a href="projects" class="btn btn-secondary">Cancel</a>
</form>

@code {
    private string _ownerRepo = "";
    private string? _errorMessage;
    private bool _isSubmitting;

    private async Task HandleSubmit()
    {
        _errorMessage = null;
        _isSubmitting = true;

        try
        {
            var result = await ProjectService.CreateAsync(_ownerRepo);

            if (result.Success)
            {
                Navigation.NavigateTo("projects");
            }
            else
            {
                _errorMessage = result.ErrorMessage;
            }
        }
        finally
        {
            _isSubmitting = false;
        }
    }
}
