@* Modal.razor - Reusable modal component using Blazor Blueprint's BbDialog *@

<BbDialog Open="@IsOpen" OnOpenChange="HandleOpenChange">
    <BbDialogContent Class="@GetDialogClasses()">
        @if (Header != null)
        {
            <BbDialogHeader>
                @Header
            </BbDialogHeader>
        }
        else if (!string.IsNullOrEmpty(Title))
        {
            <BbDialogHeader>
                <BbDialogTitle>@Title</BbDialogTitle>
            </BbDialogHeader>
        }

        @if (Body != null)
        {
            <BbDialogBody>
                @Body
            </BbDialogBody>
        }
        else if (ChildContent != null)
        {
            <BbDialogBody>
                @ChildContent
            </BbDialogBody>
        }

        @if (Footer != null)
        {
            <BbDialogFooter>
                @Footer
            </BbDialogFooter>
        }
    </BbDialogContent>
</BbDialog>

@code {
    /// <summary>
    /// Whether the modal is currently visible.
    /// </summary>
    [Parameter]
    public bool IsOpen { get; set; }

    /// <summary>
    /// Callback invoked when the modal should close.
    /// </summary>
    [Parameter]
    public EventCallback OnClose { get; set; }

    /// <summary>
    /// Optional title text for the modal header.
    /// Ignored if Header is provided.
    /// </summary>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// Custom header content. If provided, takes precedence over Title.
    /// </summary>
    [Parameter]
    public RenderFragment? Header { get; set; }

    /// <summary>
    /// Body content of the modal.
    /// </summary>
    [Parameter]
    public RenderFragment? Body { get; set; }

    /// <summary>
    /// Footer content of the modal, typically containing action buttons.
    /// </summary>
    [Parameter]
    public RenderFragment? Footer { get; set; }

    /// <summary>
    /// Default child content, used as body if Body is not provided.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Whether to show the close button in the header.
    /// </summary>
    [Parameter]
    public bool ShowCloseButton { get; set; } = true;

    /// <summary>
    /// Whether clicking the backdrop closes the modal.
    /// </summary>
    [Parameter]
    public bool CloseOnBackdropClick { get; set; } = true;

    /// <summary>
    /// Size of the modal dialog: default, sm, lg, xl.
    /// </summary>
    [Parameter]
    public ModalSize Size { get; set; } = ModalSize.Default;

    /// <summary>
    /// Whether to center the modal vertically.
    /// </summary>
    [Parameter]
    public bool Centered { get; set; }

    /// <summary>
    /// Additional CSS classes to add to the modal dialog.
    /// </summary>
    [Parameter]
    public string? DialogClass { get; set; }

    private string GetDialogClasses()
    {
        var classes = new List<string>();

        // Map ModalSize to CSS classes
        if (Size == ModalSize.Sm)
        {
            classes.Add("sm:max-w-sm");
        }
        else if (Size == ModalSize.Lg)
        {
            classes.Add("sm:max-w-2xl");
        }
        else if (Size == ModalSize.Xl)
        {
            classes.Add("sm:max-w-4xl");
        }

        if (!string.IsNullOrEmpty(DialogClass))
        {
            classes.Add(DialogClass);
        }

        return string.Join(" ", classes);
    }

    private async Task HandleOpenChange(bool open)
    {
        if (!open && OnClose.HasDelegate)
        {
            await OnClose.InvokeAsync();
        }
    }
}
