@* ConfirmModal.razor - Specialized modal for confirmation dialogs (e.g., delete confirmations) *@

<Modal IsOpen="@IsOpen"
       OnClose="@OnCancel"
       Title="@Title"
       Centered="true"
       ShowCloseButton="@ShowCloseButton"
       CloseOnBackdropClick="@CloseOnBackdropClick">
    <Body>
        @if (ChildContent != null)
        {
            @ChildContent
        }
        else if (!string.IsNullOrEmpty(Message))
        {
            <p>@Message</p>
        }
    </Body>
    <Footer>
        <BbButton Variant="ButtonVariant.Outline" OnClick="OnCancel" Disabled="@IsProcessing">
            @CancelText
        </BbButton>
        <BbButton Variant="@GetConfirmButtonVariant()" OnClick="HandleConfirm" Disabled="@IsProcessing" Loading="@IsProcessing">
            @ConfirmText
        </BbButton>
    </Footer>
</Modal>

@code {
    /// <summary>
    /// Whether the modal is currently visible.
    /// </summary>
    [Parameter]
    public bool IsOpen { get; set; }

    /// <summary>
    /// Callback invoked when the user cancels (clicks cancel button, close button, or backdrop).
    /// </summary>
    [Parameter]
    public EventCallback OnCancel { get; set; }

    /// <summary>
    /// Callback invoked when the user confirms the action.
    /// </summary>
    [Parameter]
    public EventCallback OnConfirm { get; set; }

    /// <summary>
    /// Title of the confirmation modal.
    /// </summary>
    [Parameter]
    public string Title { get; set; } = "Confirm";

    /// <summary>
    /// Simple message to display. Ignored if ChildContent is provided.
    /// </summary>
    [Parameter]
    public string? Message { get; set; }

    /// <summary>
    /// Custom content for the modal body.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Text for the confirm button.
    /// </summary>
    [Parameter]
    public string ConfirmText { get; set; } = "Confirm";

    /// <summary>
    /// Text for the cancel button.
    /// </summary>
    [Parameter]
    public string CancelText { get; set; } = "Cancel";

    /// <summary>
    /// Variant of the confirm button: Primary, Danger, Warning, Success.
    /// </summary>
    [Parameter]
    public ConfirmButtonVariant ConfirmVariant { get; set; } = ConfirmButtonVariant.Primary;

    /// <summary>
    /// Whether an operation is currently processing (shows spinner and disables buttons).
    /// </summary>
    [Parameter]
    public bool IsProcessing { get; set; }

    /// <summary>
    /// Whether to show the close button in the header.
    /// </summary>
    [Parameter]
    public bool ShowCloseButton { get; set; } = true;

    /// <summary>
    /// Whether clicking the backdrop closes the modal.
    /// </summary>
    [Parameter]
    public bool CloseOnBackdropClick { get; set; } = true;

    private ButtonVariant GetConfirmButtonVariant() => ConfirmVariant switch
    {
        ConfirmButtonVariant.Danger => ButtonVariant.Destructive,
        ConfirmButtonVariant.Warning => ButtonVariant.Secondary,
        ConfirmButtonVariant.Success => ButtonVariant.Default,
        _ => ButtonVariant.Default
    };

    private async Task HandleConfirm()
    {
        await OnConfirm.InvokeAsync();
    }
}
