
<div class="tool-group">
    <div class="tool-group-header">
        <span class="tool-group-icon">ðŸ”§</span>
        <span class="tool-group-title">
            @if (Group.Executions.Count == 1)
            {
                @:1 tool call
            }
            else
            {
                @Group.Executions.Count @:tool calls
            }
        </span>
        <span class="ml-auto flex items-center gap-sm">
            @if (Group.Executions.Any(e => e.IsRunning))
            {
                <span class="tool-group-streaming">
                    <BbSpinner Size="SpinnerSize.Small" />
                </span>
            }
            @if (Group.Executions.Count > 2)
            {
                <button class="tool-group-toggle" @onclick="ToggleShowAll" @onclick:stopPropagation="true"
                        title="@(_showAll ? "Show fewer" : "Show all")">
                    @(_showAll ? "âˆ’" : "+")
                </button>
            }
        </span>
    </div>
    <div class="tool-execution-list">
        @{
            var executions = GetVisibleExecutions();
            var hiddenCount = Group.Executions.Count - executions.Count;
        }

        @if (hiddenCount > 0)
        {
            <div class="py-xs px-md text-xs text-text-muted text-center italic border-b border-border">
                @hiddenCount earlier tool call@(hiddenCount == 1 ? "" : "s") hidden
            </div>
        }

        @foreach (var execution in executions)
        {
            <div class="tool-execution-row @(execution.IsRunning ? "running" : "") @(execution.ToolResult?.ToolSuccess == false ? "error" : "")">
                @if (execution.ToolResult != null)
                {
                    @* Has result - render using ToolResultRenderer which has its own details/summary *@
                    <ToolResultRenderer Result="execution.ToolResult" />
                }
                else
                {
                    @* No result yet - show running indicator *@
                    <div class="tool-result-block">
                        <div class="tool-result-summary running-summary">
                            <span class="tool-icon">@GetToolIcon(execution.ToolUse.ToolName ?? "Tool")</span>
                            <span class="tool-name">@(execution.ToolUse.ToolName ?? "Tool")</span>
                            <span class="tool-summary">
                                <BbSpinner Size="SpinnerSize.Small" />
                                Running...
                            </span>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public required ToolExecutionGroup Group { get; set; }

    private bool _showAll = false;

    private List<ToolExecution> GetVisibleExecutions()
    {
        if (_showAll || Group.Executions.Count <= 2)
            return Group.Executions;

        // Show the last 2 (most recent)
        return Group.Executions.Skip(Group.Executions.Count - 2).ToList();
    }

    private void ToggleShowAll()
    {
        _showAll = !_showAll;
    }

    private static string GetToolIcon(string toolName) => toolName.ToLowerInvariant() switch
    {
        "read" => "ðŸ“–",
        "write" => "âœï¸",
        "edit" => "ðŸ“",
        "bash" => "ðŸ’»",
        "task" => "ðŸ¤–",
        "explore" => "ðŸ”­",
        "grep" => "ðŸ”",
        "glob" => "ðŸ“",
        "webfetch" => "ðŸŒ",
        "websearch" => "ðŸ”Ž",
        _ => "ðŸ”§"
    };
}
