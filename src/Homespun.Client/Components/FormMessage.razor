@if (!string.IsNullOrEmpty(Message))
{
    <div class="form-message form-message-@Type.ToString().ToLower() @Class" role="@GetRole()">
        <div class="form-message-content">
            <div class="form-message-icon">
                @GetIcon(Type)
            </div>
            <div class="form-message-text">
                @if (!string.IsNullOrEmpty(Title))
                {
                    <span class="form-message-title">@Title</span>
                }
                <span class="form-message-body">@Message</span>
            </div>
        </div>
        @if (IsDismissible && OnDismiss.HasDelegate)
        {
            <button class="form-message-dismiss" @onclick="HandleDismiss" title="Dismiss" type="button">
                <i class="bi bi-x-lg" aria-hidden="true"></i>
            </button>
        }
    </div>
}

@code {
    /// <summary>
    /// The message to display.
    /// </summary>
    [Parameter]
    public string? Message { get; set; }

    /// <summary>
    /// Optional title for the message.
    /// </summary>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// The type/severity of the message.
    /// </summary>
    [Parameter]
    public FormMessageType Type { get; set; } = FormMessageType.Error;

    /// <summary>
    /// Whether the message can be dismissed.
    /// </summary>
    [Parameter]
    public bool IsDismissible { get; set; }

    /// <summary>
    /// Callback when the dismiss button is clicked.
    /// </summary>
    [Parameter]
    public EventCallback OnDismiss { get; set; }

    /// <summary>
    /// Additional CSS classes to apply.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    private async Task HandleDismiss()
    {
        if (OnDismiss.HasDelegate)
        {
            await OnDismiss.InvokeAsync();
        }
    }

    private string GetRole()
    {
        return Type switch
        {
            FormMessageType.Error => "alert",
            FormMessageType.Warning => "alert",
            _ => "status"
        };
    }

    private static MarkupString GetIcon(FormMessageType type)
    {
        var iconClass = type switch
        {
            FormMessageType.Error => "bi-x-circle",
            FormMessageType.Success => "bi-check-circle",
            FormMessageType.Warning => "bi-exclamation-triangle",
            FormMessageType.Info => "bi-info-circle",
            _ => "bi-circle"
        };
        return new MarkupString($"""<i class="bi {iconClass}" aria-hidden="true"></i>""");
    }
}
