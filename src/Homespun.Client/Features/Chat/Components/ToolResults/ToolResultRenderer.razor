
@if (Result?.ParsedToolResult != null)
{
    <div class="tool-result-block @(Result.ParsedToolResult.IsSuccess ? "" : "error")">
        <details>
            <summary class="tool-result-summary">
                <span class="tool-icon">@GetToolIcon(Result.ParsedToolResult.ToolName)</span>
                <span class="tool-name">@Result.ParsedToolResult.ToolName</span>
                <span class="tool-summary">@Result.ParsedToolResult.Summary</span>
                @if (!Result.ParsedToolResult.IsSuccess)
                {
                    <span class="error-badge">Error</span>
                }
            </summary>
            <div class="tool-result-details">
                @switch (Result.ParsedToolResult.TypedData)
                {
                    case ReadToolData readData:
                        <ReadToolResultDisplay Data="readData" />
                        break;
                    case WriteToolData writeData:
                        <WriteToolResultDisplay Data="writeData" />
                        break;
                    case BashToolData bashData:
                        <BashToolResultDisplay Data="bashData" />
                        break;
                    case AgentToolData agentData:
                        <AgentToolResultDisplay Data="agentData" />
                        break;
                    case GrepToolData grepData:
                        <GrepToolResultDisplay Data="grepData" />
                        break;
                    case GlobToolData globData:
                        <GlobToolResultDisplay Data="globData" />
                        break;
                    case WebToolData webData:
                        <WebToolResultDisplay Data="webData" />
                        break;
                    case ExitPlanModeToolData:
                        <div class="text-sm text-muted-foreground italic">Plan completed - ready to build</div>
                        break;
                    default:
                        <GenericToolResultDisplay Content="@Result.Text" />
                        break;
                }
            </div>
        </details>
    </div>
}
else
{
    @* Fallback for unparsed results *@
    <div class="tool-result-block">
        <details>
            <summary class="tool-result-summary">
                <span class="tool-icon">@GetToolIcon(Result?.ToolName ?? "Tool")</span>
                <span class="tool-name">@(Result?.ToolName ?? "Tool")</span>
                <span class="tool-summary">@GetFallbackSummary()</span>
            </summary>
            <div class="tool-result-details">
                <pre class="generic-result">@Result?.Text</pre>
            </div>
        </details>
    </div>
}

<style>
    .tool-result-block {
        border: 1px solid var(--border-color-light);
        border-radius: var(--radius-md);
        overflow: hidden;
    }

    .tool-result-block.error {
        border-left: 3px solid #ef4444;
    }

    .tool-result-block details > summary {
        list-style: none;
    }

    .tool-result-block details > summary::-webkit-details-marker {
        display: none;
    }

    .tool-result-summary {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        cursor: pointer;
        font-size: 0.8125rem;
        background: var(--bg-tertiary);
        user-select: none;
    }

    .tool-result-summary:hover {
        background: var(--bg-secondary);
    }

    .tool-icon {
        flex-shrink: 0;
        font-size: 0.875rem;
    }

    .tool-name {
        font-weight: 600;
        font-family: var(--font-mono, monospace);
        font-size: 0.75rem;
        color: var(--text-primary);
    }

    .tool-summary {
        color: var(--text-muted);
        font-size: 0.75rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        flex: 1;
        min-width: 0;
    }

    .error-badge {
        font-size: 0.625rem;
        font-weight: 700;
        text-transform: uppercase;
        color: #fff;
        background: #ef4444;
        padding: 1px 6px;
        border-radius: var(--radius-full);
        flex-shrink: 0;
    }

    .tool-result-details {
        padding: var(--spacing-sm) var(--spacing-md);
        border-top: 1px solid var(--border-color-light);
        max-height: 400px;
        overflow-y: auto;
    }

    .generic-result {
        font-family: var(--font-mono, monospace);
        font-size: 0.75rem;
        white-space: pre-wrap;
        word-break: break-all;
        margin: 0;
        color: var(--text-primary);
    }
</style>

@code {
    [Parameter]
    public ClaudeMessageContent? Result { get; set; }

    private static string GetToolIcon(string toolName) => toolName.ToLowerInvariant() switch
    {
        "read" => "ðŸ“–",
        "write" => "âœï¸",
        "edit" => "ðŸ“",
        "bash" => "ðŸ’»",
        "task" => "ðŸ¤–",
        "explore" => "ðŸ”­",
        "grep" => "ðŸ”",
        "glob" => "ðŸ“",
        "webfetch" => "ðŸŒ",
        "websearch" => "ðŸ”Ž",
        "exitplanmode" => "ðŸ“‹",
        _ => "ðŸ”§"
    };

    private string GetFallbackSummary()
    {
        if (string.IsNullOrEmpty(Result?.Text))
            return "No output";

        var firstLine = Result.Text.Split('\n')[0];
        return firstLine.Length > 60 ? firstLine[..57] + "..." : firstLine;
    }
}
