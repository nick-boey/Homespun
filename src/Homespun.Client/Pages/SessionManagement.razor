@page "/agents"
@implements IAsyncDisposable
@inject HttpSessionApiService SessionStoreApi
@inject IBreadcrumbService BreadcrumbService

<PageTitle>Agents - Homespun</PageTitle>

<h1>Agents</h1>

<div class="agent-management-page">
    @if (_isLoading)
    {
        <div class="py-5">
            <LoadingSpinner Size="SpinnerSize.Lg" Label="Loading agents..." Centered="true" />
        </div>
    }
    else
    {
        <AgentManagementPanel
            OnSessionStopped="HandleSessionStopped" />
    }

    @if (!string.IsNullOrEmpty(_errorMessage))
    {
        <div class="alert alert-danger mt-3">@_errorMessage</div>
    }
</div>

@code {
    private bool _isLoading = true;
    private string? _errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await BreadcrumbService.SetContextAsync(new BreadcrumbContext { PageName = "Agents" });
        _isLoading = false;
    }

    private void HandleSessionStopped()
    {
        StateHasChanged();
    }

    public ValueTask DisposeAsync()
    {
        return ValueTask.CompletedTask;
    }
}
