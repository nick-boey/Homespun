# Komodo Resource Sync - Homespun Stack
#
# This file declares the Homespun application stack for Komodo management.
# Komodo's Resource Sync feature reads this TOML to register, deploy, and
# auto-update the stack when newer images are pushed to GHCR.
#
# Setup (one-time):
#   1. Ensure .env.compose exists (generated by scripts/run.sh)
#   2. Create a Resource Sync in Komodo UI named "homespun-resources"
#      pointing to repo nick-boey/Homespun, branch main,
#      resource path config/komodo/resources.toml
#   3. Click "Sync" to import both the resource_sync and stack definitions
#   4. From the "homespun" Stack page, click "Deploy"
#   After this, the resource_sync below keeps itself up-to-date automatically.
#
# Prerequisites:
#   - Komodo installed and running (scripts/install-komodo.sh + scripts/run-komodo.sh)
#   - run.sh executed at least once to generate .env.compose with credentials
#   - Periphery has GHCR auth mounted at /etc/komodo/docker

## ── Resource Sync (self-referential) ─────────────────────────────────
# After the one-time manual setup, this entry keeps the sync self-managing.
# Changes pushed to main are picked up automatically.

[[resource_sync]]
name = "homespun-resources"
description = "Syncs Homespun stack definitions from the GitHub repo"

[resource_sync.config]
repo = "nick-boey/Homespun"
branch = "main"
resource_path = ["config/komodo/resources.toml"]

## ── Stack ────────────────────────────────────────────────────────────

[[stack]]
name = "homespun"
description = "Homespun - Blazor web app for managing development features and AI agents"
tags = ["homespun"]

[stack.config]
server_id = "Local"
run_directory = "/home/azureuser/repos/Homespun"
files_on_host = true
file_paths = ["docker-compose.yml"]
env_file_path = ".env.compose"
auto_update = true
poll_for_updates = true
